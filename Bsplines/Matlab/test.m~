ptc = pcread('pc_9.ply');
[coef, score] = pca(ptc.Location);
eps = 1e-3;

xgrid = dlmread('../Final/quadratic/xgrid_20.csv');
ygrid = dlmread('../Final/quadratic/ygrid_20.csv');
%xgrid(end) = xgrid(end) + eps;
%ygrid(end) = ygrid(end) + eps;

xmin = min(score(:,1));
ymin = min(score(:,2));
xyrange = [xmin, ymin];

d = 2;
Phi = BA_control(d, score, xgrid, ygrid);

global est
est = score(:,1:2);
E = error_obj(score, xgrid, ygrid, xyrange, Phi, d);


% [X, Y] = meshgrid(ceil(min(score(:,1))):floor(max(score(:,1))), ...
%     ceil(min(score(:,2))):floor(max(score(:,2))));
% 
% Z = evaluateSurface(d,X,Y,xgrid, ygrid, xyrange, Phi);
% s = surf(X,Y,Z);
% daspect([1 1 1])
% hold on
% pcshow(score, ptc.Color)
% 
% [RMSE, SSE] = LinError(d, score, xgrid, ygrid, phi);

nCameras = 2;
camSequence = [1, 2];
CPfilename = 'take3_OPTIMISED-PARAMETERS.h5';

[IntrinsicMatrix, LensDiostortionParams, RotationMatrix, TranslationMatrix] = get_camparams(nCameras, camSequence, CPfilename)